version: "3.9"

services:
    bots:
        build: .
        restart: always
        env_file:
            - .env.prod
        networks:
            - multi-music-bots
        depends_on:
            - lavalink

    redis:
        image: "redis:latest"
        container_name: "redis-server"
        ports:
            - "6379:6379"
        volumes:
            - redis-data:/data
            - ./redis.conf:/usr/local/etc/redis/redis.conf
        command: ["redis-server", "/usr/local/etc/redis/redis.conf"]
        restart: always

    lavalink:
        image: ghcr.io/lavalink-devs/lavalink:4
        container_name: lavalink
        restart: unless-stopped
        environment:
            # set Java options here
            - _JAVA_OPTIONS=-Xmx6G
            # set lavalink server port
            - SERVER_PORT=2333
            # set password for lavalink
            - LAVALINK_SERVER_PASSWORD=youshallnotpass
        volumes:
            # mount application.yml from the same directory or use environment variables
            - ./application.yaml:/opt/Lavalink/application.yaml
            # persist plugins between restarts, make sure to set the correct permissions (user: 322, group: 322)
            - ./plugins/:/opt/Lavalink/plugins/
        networks:
            - multi-music-bots
        expose:
            # lavalink exposes port 2333 to connect to for other containers (this is for documentation purposes only)
            - 2333
        ports:
            # you only need this if you want to make your lavalink accessible from outside of containers
            - "2333:2333"

    # postgres:
    #     image: postgres:16
    #     container_name: postgres
    #     restart: unless-stopped
    #     environment:
    #         - POSTGRES_USER=postgres
    #         - POSTGRES_PASSWORD=posgres
    #         - POSTGRES_DB=shiroko-multi-music-bot
    #     volumes:
    #         - postgres_data:/var/lib/postgresql/data
    #     networks:
    #         - multi-music-bots
    #     ports:
    #         - "5433:5432"

networks:
    multi-music-bots:
        driver: bridge
        ipam:
            driver: default
            config:
                - subnet: "172.25.0.0/16"
                  gateway: "172.25.0.1"
volumes:
    redis-data:
#     postgres_data:
#         driver: local
